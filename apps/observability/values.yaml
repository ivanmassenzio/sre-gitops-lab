# Default values for observability stack
kube-prometheus-stack:
  grafana:
    enabled: true
    adminPassword: "admin"
    persistence:
      enabled: true
      type: pvc
      accessModes:
        - ReadWriteOnce
      size: 5Gi
    additionalDataSources:
      - name: Loki
        type: loki
        url: http://observability-loki:3100
        access: proxy
      - name: Tempo
        type: tempo
        url: http://observability-tempo:3100
        access: proxy
  prometheus:
    prometheusSpec:
      serviceMonitorSelectorNilUsesHelmValues: false
      podMonitorSelectorNilUsesHelmValues: false
      storageSpec:
        volumeClaimTemplate:
          spec:
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 10Gi

loki-stack:
  loki:
    commonConfig:
      replication_factor: 1
    persistence:
      enabled: true
      size: 10Gi
      accessModes:
        - ReadWriteOnce
  promtail:
    enabled: false
    config:
      target_config:
        sync_period: 10s
        # Disable fsnotify to avoid "too many open files" on large nodes/clusters
        # and fallback to polling which is safer for labs
      clients:
        - url: http://observability-loki:3100/loki/api/v1/push
    extraArgs:
      - "-config.expand-env=true"
      - "-config.file=/etc/promtail/promtail.yaml"
      # Explicitly turn off fsnotify in args in addition to config
      # This is the nuclear option for "too many open files"
      - "-target.sync-period=10s"

tempo:
  persistence:
    enabled: true
    accessModes:
      - ReadWriteOnce
    size: 5Gi
  tempo:
    repository: grafana/tempo
    tag: 2.4.0
    receivers:
      jaeger:
        protocols:
          grpc:
            endpoint: 0.0.0.0:14250
          thrift_http:
            endpoint: 0.0.0.0:14268
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    storage:
      trace:
        backend: local
        local:
          path: /var/tempo/traces
        wal:
          path: /var/tempo/wal

opentelemetry-operator:
  manager:
    collectorImage:
      repository: otel/opentelemetry-collector-contrib
